// Generated by CoffeeScript 1.6.3
(function() {
  var wookmark,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  wookmark = function() {
    return $('#tiles > li').wookmark({
      align: 'left',
      autoResize: true,
      container: $('#tiles'),
      offset: 10,
      itemWidth: 230
    });
  };

  $(function() {
    var AppRouter, CardHolderView, Header, HeaderView, Info, LoginView, UrFeel, UrFeelCardView, UrFeels, _ref, _ref1, _ref2, _ref3, _ref4, _ref5, _ref6, _ref7, _ref8;
    Header = (function(_super) {
      __extends(Header, _super);

      function Header() {
        _ref = Header.__super__.constructor.apply(this, arguments);
        return _ref;
      }

      Header.prototype["default"] = {
        loggedin: false,
        menu: 'login'
      };

      return Header;

    })(Backbone.Model);
    Info = (function(_super) {
      __extends(Info, _super);

      function Info() {
        _ref1 = Info.__super__.constructor.apply(this, arguments);
        return _ref1;
      }

      Info.prototype.url = '../auth/info';

      return Info;

    })(Backbone.Model);
    UrFeel = (function(_super) {
      __extends(UrFeel, _super);

      function UrFeel() {
        _ref2 = UrFeel.__super__.constructor.apply(this, arguments);
        return _ref2;
      }

      return UrFeel;

    })(Backbone.Model);
    UrFeels = (function(_super) {
      __extends(UrFeels, _super);

      function UrFeels() {
        _ref3 = UrFeels.__super__.constructor.apply(this, arguments);
        return _ref3;
      }

      UrFeels.prototype.model = UrFeel;

      UrFeels.prototype.url = '../auth/ur';

      return UrFeels;

    })(Backbone.Collection);
    UrFeelCardView = (function(_super) {
      __extends(UrFeelCardView, _super);

      function UrFeelCardView() {
        _ref4 = UrFeelCardView.__super__.constructor.apply(this, arguments);
        return _ref4;
      }

      UrFeelCardView.prototype.tagName = 'li';

      UrFeelCardView.prototype.template = _.template($('#tpl_ur_feel_card').html());

      UrFeelCardView.prototype.render = function(event) {
        this.$el.html(this.template(this.model.toJSON()));
        return this;
      };

      return UrFeelCardView;

    })(Backbone.View);
    CardHolderView = (function(_super) {
      __extends(CardHolderView, _super);

      function CardHolderView() {
        _ref5 = CardHolderView.__super__.constructor.apply(this, arguments);
        return _ref5;
      }

      CardHolderView.prototype.tagName = 'ul';

      CardHolderView.prototype.template = _.template($('#tpl_card_holder').html());

      CardHolderView.prototype.render = function(event) {
        this.$el.html(this.template(this.model.toJSON()));
        return this;
      };

      return CardHolderView;

    })(Backbone.View);
    HeaderView = (function(_super) {
      __extends(HeaderView, _super);

      function HeaderView() {
        _ref6 = HeaderView.__super__.constructor.apply(this, arguments);
        return _ref6;
      }

      HeaderView.prototype.tagName = 'div';

      HeaderView.prototype.className = 'container';

      HeaderView.prototype.template = _.template($('#tpl_header').html());

      HeaderView.prototype.render = function(event) {
        console.log(this.model);
        console.log(this.model.toJSON());
        this.$el.html(this.template(this.model.toJSON()));
        return this;
      };

      return HeaderView;

    })(Backbone.View);
    LoginView = (function(_super) {
      __extends(LoginView, _super);

      function LoginView() {
        _ref7 = LoginView.__super__.constructor.apply(this, arguments);
        return _ref7;
      }

      LoginView.prototype.tagName = 'div';

      LoginView.prototype.template = _.template($('#tpl_login').html());

      LoginView.prototype.events = {
        'click #login_btn': 'login'
      };

      LoginView.prototype.render = function(event) {
        this.$el.html(this.template());
        return this;
      };

      LoginView.prototype.login = function(event) {
        return $.ajax({
          url: '../sessions',
          type: 'POST',
          dataType: 'json',
          data: {
            user_id: $('#user_id').val(),
            password: $('#password').val()
          },
          success: function(data) {
            return window.location.replace('#');
          }
        });
      };

      return LoginView;

    })(Backbone.View);
    $.ajaxSetup({
      statusCode: {
        401: function() {
          return window.location.replace('/#login');
        },
        403: function() {
          return window.location.replace('/#login');
        }
      }
    });
    AppRouter = (function(_super) {
      __extends(AppRouter, _super);

      function AppRouter() {
        _ref8 = AppRouter.__super__.constructor.apply(this, arguments);
        return _ref8;
      }

      AppRouter.prototype.routes = {
        "": "ur",
        "login": "login",
        "logout": "logout",
        "signup": "signup",
        "my": "my",
        "ur": "ur"
      };

      AppRouter.prototype.login = function() {
        return $.ajax({
          url: '../sessions',
          dataType: 'json',
          success: function(data) {
            var h;
            if (data.user) {
              return window.location.replace('/');
            } else {
              h = new Header;
              h.set({
                loggedin: false,
                menu: 'login'
              });
              $('#_header').html(new HeaderView({
                model: h
              }).render().el);
              return $('#_content').html(new LoginView({
                model: data
              }).render().el);
            }
          }
        });
      };

      AppRouter.prototype.logout = function() {
        return $.ajax({
          url: '../sessions',
          type: 'DELETE',
          dataType: 'json',
          success: function(data) {
            return window.location.replace('/#login');
          }
        });
      };

      AppRouter.prototype.signup = function() {
        return window.location.replace('/#login');
      };

      AppRouter.prototype.my = function() {
        return window.location.replace('/#login');
      };

      AppRouter.prototype.ur = function() {
        var info;
        info = new Info;
        return info.fetch({
          success: function(model, res) {
            var feels, h;
            feels = new UrFeels;
            feels.fetch({
              data: {
                skip: 0,
                n: 3
              },
              success: function(model, res) {
                var feel, _i, _len, _ref9;
                _ref9 = model.models;
                for (_i = 0, _len = _ref9.length; _i < _len; _i++) {
                  feel = _ref9[_i];
                  console.log(feel);
                  $('#tiles').append(new UrFeelCardView({
                    model: feel
                  }).render().el);
                }
                return wookmark();
              }
            });
            h = new Header;
            h.set({
              loggedin: true,
              menu: 'ur'
            });
            $('#_header').html(new HeaderView({
              model: h
            }).render().el);
            return $('#_content').html(new CardHolderView({
              model: model
            }).render().el);
          }
        });
      };

      return AppRouter;

    })(Backbone.Router);
    new AppRouter;
    Backbone.history.start();
    return $('#wordselect > li').on('click', function(event) {
      $('#wordselect').find('.active').removeClass('active');
      return $(this).toggleClass('active');
    });
  });

}).call(this);
